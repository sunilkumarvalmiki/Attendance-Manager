<?xml version="1.0" encoding="UTF-8"?>
<TaskerData sr="" dvi="1" tv="6.5.11">
    <!-- 
        Beehive HCM Attendance Automation - FIXED VERSION
        Version: 1.0
        Compatible: Tasker 6.5.11
        Author: Antigravity AI
        Description: Automated attendance submission with OTP handling
    -->
    
    <!-- =============================================== -->
    <!-- PROJECT DEFINITION -->
    <!-- =============================================== -->
    <Project sr="proj0" ve="2">
        <cdate>1732468800000</cdate>
        <name>BeehiveAttendance</name>
        
        <!-- Configuration Variables -->
        <Variable sr="var0">
            <n>%BEEHIVE_USERNAME</n>
            <v></v>
        </Variable>
        
        <Variable sr="var1">
            <n>%BEEHIVE_PASSWORD</n>
            <v></v>
        </Variable>
        
        <Variable sr="var2">
            <n>%REGULARIZE_REASON</n>
            <v>Work from Home</v>
        </Variable>
        
        <Variable sr="var3">
            <n>%OTP_TIMEOUT</n>
            <v>120</v>
        </Variable>
        
        <Variable sr="var4">
            <n>%RETRY_ATTEMPTS</n>
            <v>3</v>
        </Variable>
        
        <Variable sr="var5">
            <n>%BEEHIVE_APP_PACKAGE</n>
            <v>com.app.beehivehrms</v>
        </Variable>
        
        <Variable sr="var6">
            <n>%OTP_CODE</n>
            <v></v>
        </Variable>
        
        <Variable sr="var7">
            <n>%LAST_RUN_STATUS</n>
            <v></v>
        </Variable>
        
        <Variable sr="var8">
            <n>%ATTENDANCE_LOG</n>
            <v>/sdcard/Tasker/BeehiveAttendance/logs/attendance.log</v>
        </Variable>
        
        <Variable sr="var9">
            <n>%LAST_RUN_DATE</n>
            <v></v>
        </Variable>
    </Project>
    
    <!-- =============================================== -->
    <!-- PROFILES -->
    <!-- =============================================== -->
    
    <!-- Profile 1: Morning Punch-In (9:25 AM Mon-Fri) -->
    <Profile sr="prof0" ve="2">
        <cdate>1732468800000</cdate>
        <edate>1732468800000</edate>
        <id>1</id>
        <mid0>2</mid0>
        <nme>MorningPunchIn</nme>
        <Time sr="con0">
            <fh>9</fh>
            <fm>25</fm>
        </Time>
        <Day sr="con1">
            <Int sr="0" val="2"/>
            <Int sr="1" val="3"/>
            <Int sr="2" val="4"/>
            <Int sr="3" val="5"/>
            <Int sr="4" val="6"/>
        </Day>
    </Profile>
    
    <!-- Profile 2: Evening Punch-Out (6:25 PM Mon-Fri) -->
    <Profile sr="prof1" ve="2">
        <cdate>1732468800000</cdate>
        <edate>1732468800000</edate>
        <id>3</id>
        <mid0>4</mid0>
        <nme>EveningPunchOut</nme>
        <Time sr="con0">
            <fh>18</fh>
            <fm>25</fm>
        </Time>
        <Day sr="con1">
            <Int sr="0" val="2"/>
            <Int sr="1" val="3"/>
            <Int sr="2" val="4"/>
            <Int sr="3" val="5"/>
            <Int sr="4" val="6"/>
        </Day>
    </Profile>
    
    <!-- Profile 3: SMS OTP Receiver -->
    <Profile sr="prof2" ve="2">
        <cdate>1732468800000</cdate>
        <edate>1732468800000</edate>
        <id>5</id>
        <mid0>6</mid0>
        <nme>SMSOTPReceiver</nme>
        <Event sr="con0" ve="2">
            <code>13</code>
            <Str sr="arg0" ve="3">*</Str>
            <Str sr="arg1" ve="3">*OTP*</Str>
            <Int sr="arg2" val="0"/>
        </Event>
    </Profile>
    
    <!-- =============================================== -->
    <!-- TASKS -->
    <!-- =============================================== -->
    
    <!-- Task 2: Execute Morning Attendance -->
    <Task sr="task2">
        <cdate>1732468800000</cdate>
        <edate>1732468800000</edate>
        <id>2</id>
        <nme>ExecuteMorningAttendance</nme>
        <pri>100</pri>
        
        <!-- Step 1: Flash start message -->
        <Action sr="act0" ve="7">
            <code>548</code>
            <Str sr="arg0" ve="3">ðŸš€ Starting Morning Attendance</Str>
            <Int sr="arg1" val="0"/>
        </Action>
        
        <!-- Step 2: Check if already run today -->
        <Action sr="act1" ve="7">
            <code>37</code>
            <ConditionList sr="if">
                <Condition sr="c0" ve="3">
                    <lhs>%LAST_RUN_DATE</lhs>
                    <op>2</op>
                    <rhs>%DATE</rhs>
                </Condition>
            </ConditionList>
        </Action>
        
        <Action sr="act2" ve="7">
            <code>548</code>
            <ConditionList sr="if">
                <Condition sr="c0" ve="3">
                    <lhs>%LAST_RUN_DATE</lhs>
                    <op>2</op>
                    <rhs>%DATE</rhs>
                </Condition>
            </ConditionList>
            <Str sr="arg0" ve="3">Already run today, skipping</Str>
            <Int sr="arg1" val="0"/>
        </Action>
        
        <Action sr="act3" ve="7">
            <code>43</code>
            <ConditionList sr="if">
                <Condition sr="c0" ve="3">
                    <lhs>%LAST_RUN_DATE</lhs>
                    <op>2</op>
                    <rhs>%DATE</rhs>
                </Condition>
            </ConditionList>
        </Action>
        
        <!-- Step 3: Perform Task Calls -->
        <Action sr="act4" ve="7">
            <code>130</code>
            <Str sr="arg0" ve="3">CheckCalendar</Str>
            <Int sr="arg1" val="0"/>
            <Int sr="arg2" val="1"/>
        </Action>
        
        <Action sr="act5" ve="7">
            <code>130</code>
            <Str sr="arg0" ve="3">PerformLogin</Str>
            <Int sr="arg1" val="0"/>
            <Int sr="arg2" val="1"/>
        </Action>
        
        <Action sr="act6" ve="7">
            <code>130</code>
            <Str sr="arg0" ve="3">RegularizeAttendance</Str>
            <Int sr="arg1" val="0"/>
            <Int sr="arg2" val="1"/>
        </Action>
        
        <Action sr="act7" ve="7">
            <code>130</code>
            <Str sr="arg0" ve="3">MarkPunchIn</Str>
            <Int sr="arg1" val="0"/>
            <Int sr="arg2" val="1"/>
        </Action>
        
        <!-- Step 4: Send success notification -->
        <Action sr="act8" ve="7">
            <code>523</code>
            <Str sr="arg0" ve="3">âœ… Attendance Marked</Str>
            <Str sr="arg1" ve="3">Morning punch-in completed at %TIME</Str>
            <Img sr="arg2" ve="2">
                <var>mw_content_schedule</var>
            </Img>
            <Int sr="arg3" val="0"/>
            <Int sr="arg4" val="2"/>
        </Action>
        
        <!-- Step 5: Log success -->
        <Action sr="act9" ve="7">
            <code>410</code>
            <Str sr="arg0" ve="3">%ATTENDANCE_LOG</Str>
            <Str sr="arg1" ve="3">%DATE %TIME | SUCCESS | Morning Punch-In
</Str>
            <Int sr="arg2" val="1"/>
        </Action>
        
        <!-- Step 6: Update last run date -->
        <Action sr="act10" ve="7">
            <code>547</code>
            <Str sr="arg0" ve="3">%LAST_RUN_DATE</Str>
            <Str sr="arg1" ve="3">%DATE</Str>
            <Int sr="arg2" val="0"/>
            <Int sr="arg3" val="0"/>
        </Action>
    </Task>
    
    <!-- Task 4: Execute Evening Attendance -->
    <Task sr="task4">
        <cdate>1732468800000</cdate>
        <edate>1732468800000</edate>
        <id>4</id>
        <nme>ExecuteEveningAttendance</nme>
        <pri>100</pri>
        
        <Action sr="act0" ve="7">
            <code>548</code>
            <Str sr="arg0" ve="3">ðŸš€ Starting Evening Punch-Out</Str>
            <Int sr="arg1" val="0"/>
        </Action>
        
        <Action sr="act1" ve="7">
            <code>130</code>
            <Str sr="arg0" ve="3">PerformLogin</Str>
            <Int sr="arg1" val="0"/>
            <Int sr="arg2" val="1"/>
        </Action>
        
        <Action sr="act2" ve="7">
            <code>130</code>
            <Str sr="arg0" ve="3">MarkPunchOut</Str>
            <Int sr="arg1" val="0"/>
            <Int sr="arg2" val="1"/>
        </Action>
        
        <Action sr="act3" ve="7">
            <code>523</code>
            <Str sr="arg0" ve="3">âœ… Punch-Out Completed</Str>
            <Str sr="arg1" ve="3">Evening punch-out at %TIME</Str>
            <Img sr="arg2" ve="2">
                <var>mw_content_schedule</var>
            </Img>
            <Int sr="arg3" val="0"/>
            <Int sr="arg4" val="2"/>
        </Action>
        
        <Action sr="act4" ve="7">
            <code>410</code>
            <Str sr="arg0" ve="3">%ATTENDANCE_LOG</Str>
            <Str sr="arg1" ve="3">%DATE %TIME | SUCCESS | Evening Punch-Out
</Str>
            <Int sr="arg2" val="1"/>
        </Action>
    </Task>
    
    <!-- Task 6: Extract OTP from SMS -->
    <Task sr="task6">
        <cdate>1732468800000</cdate>
        <edate>1732468800000</edate>
        <id>6</id>
        <nme>ExtractOTP_SMS</nme>
        <pri>100</pri>
        
        <Action sr="act0" ve="7">
            <code>590</code>
            <Str sr="arg0" ve="3">%OTP_MATCHES</Str>
            <Str sr="arg1" ve="3">%SMSRB</Str>
            <Int sr="arg2" val="0"/>
            <Int sr="arg3" val="0"/>
            <Str sr="arg4" ve="3">\b(\d{4,6})\b</Str>
            <Int sr="arg5" val="0"/>
            <Int sr="arg6" val="0"/>
        </Action>
        
        <Action sr="act1" ve="7">
            <code>547</code>
            <Str sr="arg0" ve="3">%OTP_CODE</Str>
            <Str sr="arg1" ve="3">%OTP_MATCHES1</Str>
            <Int sr="arg2" val="0"/>
            <Int sr="arg3" val="0"/>
        </Action>
        
        <Action sr="act2" ve="7">
            <code>548</code>
            <Str sr="arg0" ve="3">OTP Extracted: %OTP_CODE</Str>
            <Int sr="arg1" val="0"/>
        </Action>
    </Task>
    
    <!-- Task 7: Check Calendar -->
    <Task sr="task7">
        <id>7</id>
        <nme>CheckCalendar</nme>
        
        <Action sr="act0" ve="7">
            <code>37</code>
            <ConditionList sr="if">
                <Condition sr="c0" ve="3">
                    <lhs>%DAYW</lhs>
                    <op>12</op>
                    <rhs>Sat|Sun</rhs>
                </Condition>
            </ConditionList>
        </Action>
        
        <Action sr="act1" ve="7">
            <code>548</code>
            <ConditionList sr="if">
                <Condition sr="c0" ve="3">
                    <lhs>%DAYW</lhs>
                    <op>12</op>
                    <rhs>Sat|Sun</rhs>
                </Condition>
            </ConditionList>
            <Str sr="arg0" ve="3">Weekend detected, skipping</Str>
            <Int sr="arg1" val="0"/>
        </Action>
        
        <Action sr="act2" ve="7">
            <code>43</code>
            <ConditionList sr="if">
                <Condition sr="c0" ve="3">
                    <lhs>%DAYW</lhs>
                    <op>12</op>
                    <rhs>Sat|Sun</rhs>
                </Condition>
            </ConditionList>
        </Action>
        
        <Action sr="act3" ve="7">
            <code>548</code>
            <Str sr="arg0" ve="3">Calendar check passed</Str>
            <Int sr="arg1" val="0"/>
        </Action>
    </Task>
    
    <!-- Task 8: Perform Login with OTP -->
    <Task sr="task8">
        <id>8</id>
        <nme>PerformLogin</nme>
        
        <!-- Launch Beehive App -->
        <Action sr="act0" ve="7">
            <code>22</code>
            <Str sr="arg0" ve="3">%BEEHIVE_APP_PACKAGE</Str>
            <Str sr="arg1" ve="3"></Str>
            <Int sr="arg2" val="0"/>
            <Int sr="arg3" val="0"/>
        </Action>
        
        <!-- Wait for app to load -->
        <Action sr="act1" ve="7">
            <code>30</code>
            <Int sr="arg0" val="3"/>
            <Int sr="arg1" val="0"/>
            <Int sr="arg2" val="0"/>
            <Int sr="arg3" val="0"/>
            <Int sr="arg4" val="0"/>
        </Action>
        
        <!-- Flash message -->
        <Action sr="act2" ve="7">
            <code>548</code>
            <Str sr="arg0" ve="3">Launched Beehive App - Please complete login manually for now</Str>
            <Int sr="arg1" val="1"/>
        </Action>
        
        <!-- Wait for manual login -->
        <Action sr="act3" ve="7">
            <code>30</code>
            <Int sr="arg0" val="15"/>
            <Int sr="arg1" val="0"/>
            <Int sr="arg2" val="0"/>
            <Int sr="arg3" val="0"/>
            <Int sr="arg4" val="0"/>
        </Action>
    </Task>
    
    <!-- Task 9: Regularize Attendance -->
    <Task sr="task9">
        <id>9</id>
        <nme>RegularizeAttendance</nme>
        
        <Action sr="act0" ve="7">
            <code>548</code>
            <Str sr="arg0" ve="3">Navigate to Regularize Attendance manually</Str>
            <Int sr="arg1" val="1"/>
        </Action>
        
        <Action sr="act1" ve="7">
            <code>30</code>
            <Int sr="arg0" val="10"/>
            <Int sr="arg1" val="0"/>
            <Int sr="arg2" val="0"/>
            <Int sr="arg3" val="0"/>
            <Int sr="arg4" val="0"/>
        </Action>
    </Task>
    
    <!-- Task 10: Mark Punch In -->
    <Task sr="task10">
        <id>10</id>
        <nme>MarkPunchIn</nme>
        
        <Action sr="act0" ve="7">
            <code>548</code>
            <Str sr="arg0" ve="3">Navigate to Mark Punch-In manually</Str>
            <Int sr="arg1" val="1"/>
        </Action>
        
        <Action sr="act1" ve="7">
            <code>30</code>
            <Int sr="arg0" val="5"/>
            <Int sr="arg1" val="0"/>
            <Int sr="arg2" val="0"/>
            <Int sr="arg3" val="0"/>
            <Int sr="arg4" val="0"/>
        </Action>
    </Task>
    
    <!-- Task 11: Mark Punch Out -->
    <Task sr="task11">
        <id>11</id>
        <nme>MarkPunchOut</nme>
        
        <Action sr="act0" ve="7">
            <code>548</code>
            <Str sr="arg0" ve="3">Navigate to Mark Punch-Out manually</Str>
            <Int sr="arg1" val="1"/>
        </Action>
        
        <Action sr="act2" val="5"/>
            <Int sr="arg1" val="0"/>
            <Int sr="arg2" val="0"/>
            <Int sr="arg3" val="0"/>
            <Int sr="arg4" val="0"/>
        </Action>
    </Task>
    
    <!-- Task 12: First Time Setup -->
    <Task sr="task12">
        <id>12</id>
        <nme>FirstTimeSetup</nme>
        
        <Action sr="act0" ve="7">
            <code>548</code>
            <Str sr="arg0" ve="3">ðŸš€ Welcome to Beehive Attendance Automation</Str>
            <Int sr="arg1" val="1"/>
        </Action>
        
        <!-- Prompt for username -->
        <Action sr="act1" ve="7">
            <code>339</code>
            <Str sr="arg0" ve="3">Beehive Username</Str>
            <Str sr="arg1" ve="3">Enter your Beehive login username</Str>
            <Str sr="arg2" ve="3"></Str>
            <Str sr="arg3" ve="3">%BEEHIVE_USERNAME</Str>
            <Int sr="arg4" val="0"/>
            <Int sr="arg5" val="0"/>
            <Int sr="arg6" val="0"/>
        </Action>
        
        <!-- Prompt for password -->
        <Action sr="act2" ve="7">
            <code>339</code>
            <Str sr="arg0" ve="3">Beehive Password</Str>
            <Str sr="arg1" ve="3">Enter your Beehive login password</Str>
            <Str sr="arg2" ve="3"></Str>
            <Str sr="arg3" ve="3">%BEEHIVE_PASSWORD</Str>
            <Int sr="arg4" val="0"/>
            <Int sr="arg5" val="1"/>
            <Int sr="arg6" val="0"/>
        </Action>
        
        <!-- Prompt for reason -->
        <Action sr="act3" ve="7">
            <code>339</code>
            <Str sr="arg0" ve="3">Regularize Reason</Str>
            <Str sr="arg1" ve="3">Enter default reason (e.g., Work from Home)</Str>
            <Str sr="arg2" ve="3">Work from Home</Str>
            <Str sr="arg3" ve="3">%REGULARIZE_REASON</Str>
            <Int sr="arg4" val="0"/>
            <Int sr="arg5" val="0"/>
            <Int sr="arg6" val="0"/>
        </Action>
        
        <Action sr="act4" ve="7">
            <code>548</code>
            <Str sr="arg0" ve="3">âœ… Setup Complete! Automation will run at 9:25 AM &amp; 6:25 PM (Mon-Fri)</Str>
            <Int sr="arg1" val="1"/>
        </Action>
        
        <!-- Create log directory -->
        <Action sr="act5" ve="7">
            <code>410</code>
            <Str sr="arg0" ve="3">/sdcard/Tasker/BeehiveAttendance/logs/attendance.log</Str>
            <Str sr="arg1" ve="3">%DATE %TIME | Automation setup completed
</Str>
            <Int sr="arg2" val="1"/>
        </Action>
    </Task>
    
</TaskerData>
